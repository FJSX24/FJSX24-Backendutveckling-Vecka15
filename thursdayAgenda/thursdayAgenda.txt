ğŸ§­ Workshop â€“ Torsdag v.15
Datum: 2025-04-10
Tid: 09.00â€“12.00
Plats: Ordinarie schema
Ã„mne: Middleware i Express

----------------------------------------
âœ¨ Syfte
FÃ¶rstÃ¥ vad middleware Ã¤r i Express, varfÃ¶r det anvÃ¤nds och hur man skapar egen middleware. Introducera `app.use()` och `next()`. Samt fÃ¶rmÃ¥gan att implementera avancerade lÃ¶sningar fÃ¶r loggning, sÃ¤kerhet och kontrollflÃ¶de i Express. Introducera Winston, Morgan, samt rate limiting och autentisering via API-nycklar.

----------------------------------------
ğŸ¯ KursmÃ¥l
K1: FÃ¶rklara hur Express anvÃ¤nder middleware

F1: Skapa och anvÃ¤nda middleware fÃ¶r logging och error handling

----------------------------------------
ğŸ§  Agenda

ğŸ“ Teori & PowerPoint:	Vad Ã¤r middleware, kedjan, next, app.use(), tredjepartsverktyg, loggning, sÃ¤kerhet

ğŸ’» Code-Along:	Logger och error-middleware, testa i Postman

ğŸ”§ SjÃ¤lvstÃ¤ndiga Ã¶vningar:

ğŸ§ª Test & Reflektion:	Diskutera skillnader mellan route-middleware och global

ğŸ§³ Code review & feedback:	Visa upp egna middleware-lÃ¶sningar

----------------------------------------
----------------------------------------
----------------------------------------
ğŸ§  Teori (30 min)

- Vad Ã¤r middleware?
- Vanliga anvÃ¤ndningsomrÃ¥den: loggning, validering, auth, error handling
- GenomgÃ¥ng av `app.use()`, `next()`, samt middleware-kedjan

"God morgon! Idag ska vi titta nÃ¤rmare pÃ¥ en viktig del av Express â€“ nÃ¤mligen middleware. Middleware fungerar som ett lager mellan inkommande request och det slutliga svaret. Ni kommer lÃ¤ra er att logga inkommande requests, validera data innan det nÃ¥r en route, och hantera fel globalt. Vi kommer Ã¤ven att bygga egna middlewarefunktioner och fÃ¶rstÃ¥ hur de kopplas in i flÃ¶det."

"Vi kommer att jobba praktiskt med `app.use()`, `next()`, loggning av headers och anrop, samt skapa en `error handler` som fÃ¥ngar upp fel och svarar snyggt till klienten. Allt detta ger er stÃ¶rre kontroll och sÃ¤kerhet i era API:er."

ğŸ–¥ï¸ PowerPoint-innehÃ¥ll: Middleware i Express

Slide 1 â€“ Vad Ã¤r Middleware?

Text pÃ¥ sliden:

Funktion som kÃ¶rs mellan request och response

Har tillgÃ¥ng till req, res och next

Kan anvÃ¤ndas fÃ¶r: autentisering, validering, loggning, felhantering och mycket mer.

Talarmanus: "Alla middleware kÃ¶rs i den ordning de definieras. next() hoppar till nÃ¤sta middleware eller route. Om du glÃ¶mmer next(), fastnar kedjan.

Middleware Ã¤r funktioner som kÃ¶rs mellan det att en fÃ¶rfrÃ¥gan kommer in och innan ett svar skickas tillbaka. De kan logga information, manipulera request- eller response-objektet, och till och med stoppa eller omdirigera flÃ¶det."

----------------------------------------
Slide 2: VarfÃ¶r anvÃ¤nda Middleware?

"Genom att anvÃ¤nda middleware kan vi strukturera vÃ¥r applikationslogik pÃ¥ ett mer modulÃ¤rt sÃ¤tt. IstÃ¤llet fÃ¶r att ha all logik samlad pÃ¥ en plats kan vi dela upp funktionaliteten i separata moduler. Detta gÃ¶r applikationen mer Ã¥teranvÃ¤ndbar och lÃ¤ttare att underhÃ¥lla."

Talarmanus: "Alla middleware-funktioner tar tre argument â€“ req, res och next. next() Ã¤r avgÃ¶rande â€“ den sÃ¤ger 'gÃ¥ vidare till nÃ¤sta middleware eller route'. GlÃ¶mmer vi det? DÃ¥ fastnar servern."
Exekveras i den ordning de definieras

----------------------------------------
Slide 3: Middleware i Express.js

"I Express anvÃ¤nder vi funktionen app.use() fÃ¶r att lÃ¤gga till middleware i vÃ¥r applikation. Ett vanligt exempel Ã¤r app.use(express.json()), som gÃ¶r det mÃ¶jligt att hantera JSON-data i inkommande requests. Middleware kan ocksÃ¥ anvÃ¤ndas fÃ¶r att manipulera bÃ¥de request- och response-objekt."

----------------------------------------
Slide 4: Typer av Middleware (Ny)

"Det finns flera typer av middleware i Express:

Inbyggda middleware - TillhandahÃ¥lls av Express, t.ex. express.json().

AnvÃ¤ndardefinierade middleware - Skapade av oss sjÃ¤lva fÃ¶r specifika syften.

Tredjeparts middleware - Exempelvis morgan fÃ¶r loggning. Middleware kan kedjas i en pipeline dÃ¤r varje middleware anropar next() fÃ¶r att Ã¶vergÃ¥ till nÃ¤sta steg."


----------------------------------------
Slide 5 â€“ Error Handling Middleware

Talarmanus: FÃ¶r felhantering anvÃ¤nds en speciell typ av middleware med fyra argument â€“ err, req, res, next. Om ett fel skickas vidare med next(err), fÃ¥ngas det hÃ¤r.

----------------------------------------
----------------------------------------
----------------------------------------
ğŸ’» Code-Along 

ğŸ’¡ MÃ¥l:
FÃ¶rstÃ¥ hur man bygger avancerade middleware-funktioner.

LÃ¤ra sig anvÃ¤nda bÃ¥de inbyggd och tredjeparts-middleware.

Bygga en komplett logging- och felhanteringslÃ¶sning.

LÃ¤ra sig hur middleware-kedjan fungerar.

ğŸ—£ï¸ Talarmanus - Introduktion:
"Hej allihopa! Idag ska vi dyka ner i vÃ¤rlden av middleware i Express.js. Vi kommer att bygga en robust applikation som hanterar logging, felhantering och rÃ¤knar antalet requests. FÃ¶r att gÃ¶ra detta ska vi anvÃ¤nda nÃ¥gra kraftfulla bibliotek och skapa egna middlewarefunktioner.

Men innan vi bÃ¶rjar koda, lÃ¥t oss snabbt prata om de verktyg vi kommer att anvÃ¤nda idag:"

ğŸ“š Bibliotek vi anvÃ¤nder idag

ğŸ“ Morgan
"Morgan Ã¤r ett HTTP-requestloggeringsbibliotek fÃ¶r Node.js. Det fungerar som en middleware och loggar alla inkommande requests till konsolen. Det Ã¤r anvÃ¤ndbart fÃ¶r att snabbt fÃ¥ en Ã¶verblick av trafiken i applikationen. Vi anvÃ¤nder Morgan fÃ¶r enkel och automatisk loggning av inkommande requests."

ğŸª“ Winston
"Winston Ã¤r ett flexibelt och mÃ¥ngsidigt loggningsbibliotek fÃ¶r Node.js. Det Ã¤r byggt fÃ¶r att hantera bÃ¥de loggning i konsolen och loggning till filer. Vi anvÃ¤nder Winston fÃ¶r att skapa en centraliserad loggning som bÃ¥de skrivs ut till terminalen och sparas i en fil. Det gÃ¶r det lÃ¤tt att granska applikationens beteende i efterhand."

ğŸ—£ï¸ Talarmanus - Code-Along Start:
"Nu nÃ¤r vi har koll pÃ¥ vilka bibliotek vi kommer att anvÃ¤nda, Ã¤r det dags att sÃ¤tta igÃ¥ng med kodningen! Vi kommer att strukturera vÃ¥rt projekt och bygga det steg fÃ¶r steg. HÃ¤ng med och stÃ¤ll gÃ¤rna frÃ¥gor under tiden!"


1. ProjektuppsÃ¤ttning
ğŸ—£ï¸ Talarmanus: "FÃ¶rst skapar vi en ny mapp fÃ¶r projektet och initierar ett npm-projekt. Vi installerar ocksÃ¥ de bibliotek vi behÃ¶ver: Express fÃ¶r sjÃ¤lva servern, Morgan fÃ¶r enkel request-loggning och Winston fÃ¶r mer avancerad logghantering."

npm init -y
npm install express morgan winston
touch index.js

2. Projektstruktur
ğŸ—£ï¸ Talarmanus: "FÃ¶r att hÃ¥lla koden organiserad skapar vi en mapp fÃ¶r vÃ¥ra middleware och en fÃ¶r loggfiler. Vi skapar ocksÃ¥ nÃ¥gra filer dÃ¤r vi definierar vÃ¥ra middleware."

ğŸ“ Middleware: Logger (Winston)
ğŸ—£ï¸ Talarmanus: "Vi bÃ¶rjar med att bygga vÃ¥r loggningsmiddleware med hjÃ¤lp av Winston. Detta kommer att ge oss loggar bÃ¥de i terminalen och i en fil. Loggning Ã¤r viktigt fÃ¶r att hÃ¥lla koll pÃ¥ applikationens aktivitet och eventuella problem."

middleware/logger.js

GenomfÃ¶r den koden.

ğŸ—£ï¸ Talarmanus:
"HÃ¤r har vi en middleware som anvÃ¤nder Winston fÃ¶r att skapa en loggfil som bÃ¥de visar tidpunkt, loggningsnivÃ¥ och meddelande. Vi anvÃ¤nder ocksÃ¥ console-transport fÃ¶r att fÃ¥ ut loggarna direkt i terminalen. Varje request som kommer in loggas automatiskt med HTTP-metod och URL."

ğŸ“ Middleware: Felhantering
ğŸ—£ï¸ Talarmanus: "FÃ¶r att hantera fel i applikationen pÃ¥ ett centralt sÃ¤tt skapar vi en felhanteringsmiddleware. Denna middleware fÃ¥ngar upp fel och loggar dem med Winston, samtidigt som vi skickar ett standardiserat svar till klienten."

middleware/errorHandler.js

GenomfÃ¶r den koden.

ğŸ—£ï¸ Talarmanus:
"Felhanteringsmiddleware har fyra parametrar: err, req, res och next. NÃ¤r nÃ¥got gÃ¥r fel, loggar vi felet och skickar tillbaka ett standardiserat felmeddelande till klienten. Det gÃ¶r det lÃ¤ttare att fÃ¶rstÃ¥ vad som gick snett."

ğŸ“ Middleware: Request Counter
ğŸ—£ï¸ Talarmanus: "Vi skapar ocksÃ¥ en middleware som rÃ¤knar antalet inkommande requests. Detta Ã¤r anvÃ¤ndbart fÃ¶r att hÃ¥lla koll pÃ¥ hur mÃ¥nga anrop vÃ¥r server hanterar."

middleware/requestCounter.js

GenomfÃ¶r den koden.

Huvudfilen: server.js

ğŸ—£ï¸ Talarmanus: "Nu sÃ¤tter vi ihop allting i vÃ¥r huvudfil. Vi kopplar ihop alla middleware och sÃ¤tter upp nÃ¥gra routes fÃ¶r att testa."

GenomfÃ¶r den koden.

----------------------------------------
----------------------------------------
----------------------------------------
ğŸ—£ï¸ Talarmanus - Testning:
"Nu Ã¤r vi redo att testa applikationen. Vi startar servern med node server.js och Ã¶ppnar webblÃ¤saren pÃ¥ http://localhost:3000/. Vi kan ocksÃ¥ besÃ¶ka http://localhost:3000/error fÃ¶r att simulera ett fel. Loggfilerna skapas i mappen logs/, och vi kan granska dem med kommandot tail -f logs/combined.log."

Starta servern:
node server.js

Testa endpoints:

http://localhost:3000/ â†’ Kolla loggar och rÃ¤knare.

http://localhost:3000/error â†’ Simulerar ett serverfel.

Kontrollera loggfiler i mappen logs/:

ğŸ’¡ Vad har vi lÃ¤rt oss?
Hur man anvÃ¤nder tredjepartsloggning med winston.

Hur man skapar en anpassad middleware fÃ¶r request-logging.

Hur man hanterar fel globalt med en dedikerad middleware.

Hur man implementerar en middleware fÃ¶r att rÃ¤kna antal inkommande requests

----------------------------------------
----------------------------------------
----------------------------------------
âš–ï¸ Dags fÃ¶r Ã¶vningar

----------------------------------------
ğŸ§³ Gruppdiskussion 

VarfÃ¶r Ã¤r det viktigt att anvÃ¤nda middleware i en Express-applikation och nÃ¤r bÃ¶r man anvÃ¤nda middleware?

Hur skulle ni kunna anvÃ¤nda felhanteringsmiddleware i en produktionsmiljÃ¶?

Vad Ã¤r fÃ¶rdelen med att skapa egen middleware istÃ¤llet fÃ¶r att anvÃ¤nda tredjepartsbibliotek?